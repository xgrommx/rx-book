<!DOCTYPE HTML>
<html lang="en-US" manifest="..\../manifest.appcache">
    <head prefix="og: http://ogp.me/ns# book: http://ogp.me/ns/book#">
        
        <meta charset="UTF-8">
        <title>Implementing Your Own Observable Operators | RxJS</title>

        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="robots" content="index, follow">
        <meta name="author" content="xgrommx">
        <meta name="description" content="Reactive Extensions (Rx) is a library for composing asynchronous and event-based programs using observable sequences and LINQ-style query operators.">
        <meta name="keywords" content="gitbook,github" >
        <meta name="generator" content="www.gitbook.io">

        
        <link rel="next" href="..\../content/creating_and_querying_observable_sequences/README.html" />
        
        
        <link rel="prev" href="..\../content/getting_started_with_rxjs/testing_your_rx_application.html" />
        

        <meta property="og:title" content="Implementing Your Own Observable Operators | RxJS">
        <meta property="og:site_name" content="RxJS">
        <meta property="og:type" content="book">
        <meta property="og:locale" content="en_US">

        <meta property="book:author" content="https://github.com/xgrommx">
        <meta property="book:tag" content="GitBook">

        <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-status-bar-style" content="black">

        <link rel="shortcut icon" href="..\..\gitbook/images/favicon.ico" type="image/x-icon">
        
    </head>
    <body>
        

        <link rel="stylesheet" href="..\..\gitbook/style.css">
        


        
    <div class="book" data-github="xgrommx/rx-book" data-level="1.6" data-basepath="..\.." data-revision="1399940773360">
    <div class="book-header">
    <!-- Actions Left -->
    
    <a href="https://github.com/xgrommx/rx-book" target="_blank" class="btn pull-left"><i class="fa fa-bookmark-o"></i></a>
    
    <a href="#" class="btn pull-left toggle-summary"><i class="fa fa-align-justify"></i></a>
    <a href="#" class="btn pull-left toggle-search"><i class="fa fa-search"></i></a>
    <span id="font-settings-wrapper">
        <a href="#" class="btn pull-left toggle-font-settings"><i class="fa fa-font"></i>
        </a>
        <div class="dropdown-menu font-settings">
	<div class="dropdown-caret">
  <span class="caret-outer"></span>
  <span class="caret-inner"></span>
</div>

	<div class="btn-group btn-block">
		<button id="reduce-font-size" class="btn btn-default">A</button>
		<button id="enlarge-font-size" class="btn btn-default">A</button>
	</div>

	<ul class="list-group font-family-list">
		<li class="list-group-item" data-font="0">Serif</li>
		<li class="list-group-item" data-font="1">Sans</li>
	</ul>

	<div class="btn-group btn-group-xs btn-block color-theme-list">
	  <button type="button" class="btn btn-default" id="color-theme-preview-0" data-theme="0">White</button>
	  <button type="button" class="btn btn-default" id="color-theme-preview-1" data-theme="1">Sepia</button>
	  <button type="button" class="btn btn-default" id="color-theme-preview-2" data-theme="2">Night</button>
	</div>
</div>

    </span>

    <!-- Actions Right -->
    
    <a href="#" target="_blank" class="btn pull-right" data-sharing="google-plus"><i class="fa fa-google-plus"></i></a>
    
    
    <a href="#" target="_blank" class="btn pull-right" data-sharing="facebook"><i class="fa fa-facebook"></i></a>
    
    
    <a href="#" target="_blank" class="btn pull-right" data-sharing="twitter"><i class="fa fa-twitter"></i></a>
    

    
    <a href="https://github.com/xgrommx/rx-book/stargazers" target="_blank" class="btn pull-right count-star hidden-xs"><i class="fa fa-star-o"></i> Star (<span>-</span>)</a>
    <a href="https://github.com/xgrommx/rx-book/watchers" target="_blank" class="btn pull-right count-watch hidden-xs"><i class="fa fa-eye"></i> Watch (<span>-</span>)</a>
    

    <!-- Title -->
    <h1>
        <i class="fa fa-spinner fa-spin"></i>
        <a href="..\../" >RxJS</a>
    </h1>
</div>

    <div class="book-summary">
    <div class="book-search">
        <input type="text" placeholder="Search" class="form-control" />
    </div>
    <ul class="summary">
        
        <li>
            <a href="https://github.com/xgrommx" target="blank">About the author</a>
        </li>
        

        
        <li>
            <a href="https://github.com/xgrommx/rx-book/issues" target="blank">Questions and Issues</a>
        </li>
        

        
        <li>
            <a href="https://github.com/xgrommx/rx-book/edit/master/content/getting_started_with_rxjs/implementing_your_own_observable_operators.md" target="blank">Edit and Contribute</a>
        </li>
        

        
        <li class="divider"></li>
        

        <li data-level="0" data-path="index.html">
            <a href="..\../"><i class="fa fa-check"></i> Introduction</a>
        </li>
        
            <li  data-level="1" data-path="content/getting_started_with_rxjs/README.html">
                
                <a href="..\../content/getting_started_with_rxjs/README.html">
                    <i class="fa fa-check"></i> <b>1.</b> Getting Started With RxJS
                </a>
                
                
                <ul class="articles">
                    
                        <li  data-level="1.1" data-path="content/getting_started_with_rxjs/what_are_the_reactive_extensions.html">
                            
                            <a href="..\../content/getting_started_with_rxjs/what_are_the_reactive_extensions.html">
                                <i class="fa fa-check"></i> <b>1.1.</b> What are the Reactive Extensions?
                            </a>
                            
                        </li>
                    
                        <li  data-level="1.2" data-path="content/getting_started_with_rxjs/exploring_major_concepts_in_rxjs.html">
                            
                            <a href="..\../content/getting_started_with_rxjs/exploring_major_concepts_in_rxjs.html">
                                <i class="fa fa-check"></i> <b>1.2.</b> Exploring Major Concepts in RxJS
                            </a>
                            
                        </li>
                    
                        <li  data-level="1.3" data-path="content/getting_started_with_rxjs/subjects.html">
                            
                            <a href="..\../content/getting_started_with_rxjs/subjects.html">
                                <i class="fa fa-check"></i> <b>1.3.</b> Subjects
                            </a>
                            
                        </li>
                    
                        <li  data-level="1.4" data-path="content/getting_started_with_rxjs/using_schedulers.html">
                            
                            <a href="..\../content/getting_started_with_rxjs/using_schedulers.html">
                                <i class="fa fa-check"></i> <b>1.4.</b> Using Schedulers
                            </a>
                            
                        </li>
                    
                        <li  data-level="1.5" data-path="content/getting_started_with_rxjs/testing_your_rx_application.html">
                            
                            <a href="..\../content/getting_started_with_rxjs/testing_your_rx_application.html">
                                <i class="fa fa-check"></i> <b>1.5.</b> Testing your Rx application
                            </a>
                            
                        </li>
                    
                        <li  data-level="1.6" data-path="content/getting_started_with_rxjs/implementing_your_own_observable_operators.html">
                            
                            <a href="..\../content/getting_started_with_rxjs/implementing_your_own_observable_operators.html">
                                <i class="fa fa-check"></i> <b>1.6.</b> Implementing Your Own Observable Operators
                            </a>
                            
                        </li>
                    
                </ul>
                
            </li>
        
            <li  data-level="2" data-path="content/creating_and_querying_observable_sequences/README.html">
                
                <a href="..\../content/creating_and_querying_observable_sequences/README.html">
                    <i class="fa fa-check"></i> <b>2.</b> Creating and Querying Observable Sequences
                </a>
                
                
                <ul class="articles">
                    
                        <li  data-level="2.1" data-path="content/creating_and_querying_observable_sequences/creating_and_subscribing_to_simple_observable_sequences.html">
                            
                            <a href="..\../content/creating_and_querying_observable_sequences/creating_and_subscribing_to_simple_observable_sequences.html">
                                <i class="fa fa-check"></i> <b>2.1.</b> Creating and Subscribing to Simple Observable Sequences
                            </a>
                            
                        </li>
                    
                        <li  data-level="2.2" data-path="content/creating_and_querying_observable_sequences/bridging_to_events.html">
                            
                            <a href="..\../content/creating_and_querying_observable_sequences/bridging_to_events.html">
                                <i class="fa fa-check"></i> <b>2.2.</b> Bridging to Events
                            </a>
                            
                        </li>
                    
                        <li  data-level="2.3" data-path="content/creating_and_querying_observable_sequences/bridging_to_callbacks_and_promises.html">
                            
                            <a href="..\../content/creating_and_querying_observable_sequences/bridging_to_callbacks_and_promises.html">
                                <i class="fa fa-check"></i> <b>2.3.</b> Bridging to Callbacks and Promises
                            </a>
                            
                        </li>
                    
                        <li  data-level="2.4" data-path="content/creating_and_querying_observable_sequences/querying_observable_sequences.html">
                            
                            <a href="..\../content/creating_and_querying_observable_sequences/querying_observable_sequences.html">
                                <i class="fa fa-check"></i> <b>2.4.</b> Querying Observable Sequences
                            </a>
                            
                        </li>
                    
                        <li  data-level="2.5" data-path="content/creating_and_querying_observable_sequences/operators_by_category.html">
                            
                            <a href="..\../content/creating_and_querying_observable_sequences/operators_by_category.html">
                                <i class="fa fa-check"></i> <b>2.5.</b> Operators by Category
                            </a>
                            
                        </li>
                    
                </ul>
                
            </li>
        
            <li  data-level="3" data-path="content/observable/README.html">
                
                <a href="..\../content/observable/README.html">
                    <i class="fa fa-check"></i> <b>3.</b> Rx.Observable
                </a>
                
                
                <ul class="articles">
                    
                        <li  data-level="3.1" data-path="content/observable/amb.html">
                            
                            <a href="..\../content/observable/amb.html">
                                <i class="fa fa-check"></i> <b>3.1.</b> amb
                            </a>
                            
                        </li>
                    
                        <li  data-level="3.2" data-path="content/observable/case.html">
                            
                            <a href="..\../content/observable/case.html">
                                <i class="fa fa-check"></i> <b>3.2.</b> case
                            </a>
                            
                        </li>
                    
                        <li  data-level="3.3" data-path="content/observable/catch.html">
                            
                            <a href="..\../content/observable/catch.html">
                                <i class="fa fa-check"></i> <b>3.3.</b> catch
                            </a>
                            
                        </li>
                    
                        <li  data-level="3.4" data-path="content/observable/concat.html">
                            
                            <a href="..\../content/observable/concat.html">
                                <i class="fa fa-check"></i> <b>3.4.</b> concat
                            </a>
                            
                        </li>
                    
                        <li  data-level="3.5" data-path="content/observable/create.html">
                            
                            <a href="..\../content/observable/create.html">
                                <i class="fa fa-check"></i> <b>3.5.</b> create
                            </a>
                            
                        </li>
                    
                </ul>
                
            </li>
        

        
        <li class="divider"></li>
        <li>
            <a href="http://www.gitbook.io/" target="blank">Generated using GitBook</a>
        </li>
        
    </ul>
</div>

    <div class="book-body">
        <div class="body-inner">
            <div class="page-wrapper" tabindex="-1">
                <div class="book-progress">
    <div class="bar">
        <div class="inner" style="width: 36.8421052631579%;min-width: 31.57894736842105%;"></div>
    </div>
    <div class="chapters">
    
        <a href="..\../index.html" title="Introduction" class="chapter done new-chapter" data-progress="0" style="left: 0%;"></a>
    
        <a href="..\../content/getting_started_with_rxjs/README.html" title="Getting Started With RxJS" class="chapter done new-chapter" data-progress="1" style="left: 5.2631578947368425%;"></a>
    
        <a href="..\../content/getting_started_with_rxjs/what_are_the_reactive_extensions.html" title="What are the Reactive Extensions?" class="chapter done " data-progress="1.1" style="left: 10.526315789473685%;"></a>
    
        <a href="..\../content/getting_started_with_rxjs/exploring_major_concepts_in_rxjs.html" title="Exploring Major Concepts in RxJS" class="chapter done " data-progress="1.2" style="left: 15.789473684210526%;"></a>
    
        <a href="..\../content/getting_started_with_rxjs/subjects.html" title="Subjects" class="chapter done " data-progress="1.3" style="left: 21.05263157894737%;"></a>
    
        <a href="..\../content/getting_started_with_rxjs/using_schedulers.html" title="Using Schedulers" class="chapter done " data-progress="1.4" style="left: 26.31578947368421%;"></a>
    
        <a href="..\../content/getting_started_with_rxjs/testing_your_rx_application.html" title="Testing your Rx application" class="chapter done " data-progress="1.5" style="left: 31.57894736842105%;"></a>
    
        <a href="..\../content/getting_started_with_rxjs/implementing_your_own_observable_operators.html" title="Implementing Your Own Observable Operators" class="chapter done " data-progress="1.6" style="left: 36.8421052631579%;"></a>
    
        <a href="..\../content/creating_and_querying_observable_sequences/README.html" title="Creating and Querying Observable Sequences" class="chapter  new-chapter" data-progress="2" style="left: 42.10526315789474%;"></a>
    
        <a href="..\../content/creating_and_querying_observable_sequences/creating_and_subscribing_to_simple_observable_sequences.html" title="Creating and Subscribing to Simple Observable Sequences" class="chapter  " data-progress="2.1" style="left: 47.36842105263158%;"></a>
    
        <a href="..\../content/creating_and_querying_observable_sequences/bridging_to_events.html" title="Bridging to Events" class="chapter  " data-progress="2.2" style="left: 52.63157894736842%;"></a>
    
        <a href="..\../content/creating_and_querying_observable_sequences/bridging_to_callbacks_and_promises.html" title="Bridging to Callbacks and Promises" class="chapter  " data-progress="2.3" style="left: 57.89473684210526%;"></a>
    
        <a href="..\../content/creating_and_querying_observable_sequences/querying_observable_sequences.html" title="Querying Observable Sequences" class="chapter  " data-progress="2.4" style="left: 63.1578947368421%;"></a>
    
        <a href="..\../content/creating_and_querying_observable_sequences/operators_by_category.html" title="Operators by Category" class="chapter  " data-progress="2.5" style="left: 68.42105263157895%;"></a>
    
        <a href="..\../content/observable/README.html" title="Rx.Observable" class="chapter  new-chapter" data-progress="3" style="left: 73.6842105263158%;"></a>
    
        <a href="..\../content/observable/amb.html" title="amb" class="chapter  " data-progress="3.1" style="left: 78.94736842105263%;"></a>
    
        <a href="..\../content/observable/case.html" title="case" class="chapter  " data-progress="3.2" style="left: 84.21052631578948%;"></a>
    
        <a href="..\../content/observable/catch.html" title="catch" class="chapter  " data-progress="3.3" style="left: 89.47368421052632%;"></a>
    
        <a href="..\../content/observable/concat.html" title="concat" class="chapter  " data-progress="3.4" style="left: 94.73684210526316%;"></a>
    
        <a href="..\../content/observable/create.html" title="create" class="chapter  " data-progress="3.5" style="left: 100%;"></a>
    
    </div>
</div>

                <div class="page-inner">
                
                    <section class="normal" id="section-gitbook_8">
                    
                        <h1 id="implementing-your-own-observable-operators">Implementing Your Own Observable Operators</h1>
<p>You can extend RxJS by adding new operators for operations that are not provided by the base library, or by creating your own implementation of standard query operators to improve readability and performance. Writing a customized version of a standard operator is useful when you want to operate with in-memory objects and when the intended customization does not require a comprehensive view of the query.</p>
<h2 id="creating-new-operators">Creating New Operators</h2>
<p>RxJS offers a full set of operators that cover most of the possible operations on a set of entities. However, you might need an operator to add a particular semantic meaning to your queryâ€”especially if you can reuse that same operator several times in your code.  Adding new operators to RxJS is a way to extend its capabilities. However, you can also improve code readability by wrapping existing operators into more specialized and meaningful ones.</p>
<p>For example, let&#39;s see how we might implement the <a href="http://lodash.com/docs#where" target="_blank">_.where</a> method from <a href="http://lodash.com/" target="_blank">Lo-Dash</a> or <a href="http://underscorejs.org/" target="_blank">Underscore</a>, which takes a set of attributes and does a deep comparison for equality.  We might try implementing this from scratch using the <code>Rx.Observable.createWithDisposable</code> method such as the following code.</p>
<pre><code class="lang-js">Rx.Observable.prototype.whereProperties = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(properties)</span> {</span>
    <span class="hljs-keyword">var</span> source = <span class="hljs-keyword">this</span>,
        comparer = Rx.Internals.equals;

    <span class="hljs-keyword">return</span> Rx.Observable.filterByProperties(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(observer)</span> {</span>
        <span class="hljs-comment">// Our disposable is the subscription from the parent</span>
        <span class="hljs-keyword">return</span> source.subscribe(
            <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(data)</span> {</span>

                <span class="hljs-keyword">try</span> {
                    <span class="hljs-keyword">var</span> shouldRun = <span class="hljs-literal">true</span>;

                    <span class="hljs-comment">// Iterate the properties for deep equality</span>
                    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> prop <span class="hljs-keyword">in</span> properties) {
                        <span class="hljs-keyword">if</span> (!comparer(properties[prop], data[prop])) {
                            shouldRun = <span class="hljs-literal">false</span>;
                            <span class="hljs-keyword">break</span>;
                        }
                    }
                } <span class="hljs-keyword">catch</span> (e) {
                    observer.onError(e);
                }

                <span class="hljs-keyword">if</span> (shouldRun) {
                    observer.onNext(data);
                }
            },
            observer.onError.bind(observer),
            observer.onCompleted.bind(observer)
        );
    });
};
</code></pre>
<p>Many existing operators, such as this, instead could be built using other basic operators for example in this case, <code>filter</code> or <code>where</code>.  In fact, many existing operators are built using other basic operators. For example, the <code>flatMap</code> or <code>selectMany</code> operator is built by composing the <code>map</code> or <code>select</code> and <code>mergeObservable</code> operators, as the following code shows.</p>
<pre><code class="lang-js">Rx.Observable.prototype.flatMap = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(selector)</span> {</span>
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.map(selector).mergeObservable();
};
</code></pre>
<p>We could rewrite it as the following to take advantage of already built in operators.</p>
<pre><code class="lang-js">Rx.Observable.prototype.filterByProperties = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(properties)</span> {</span>
    <span class="hljs-keyword">var</span> comparer = Rx.Internals.equals;

    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.filter(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(data)</span> {</span>

        <span class="hljs-comment">// Iterate the properties for deep equality</span>
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> prop <span class="hljs-keyword">in</span> properties) {
            <span class="hljs-keyword">if</span> (!comparer(properties[prop], data[prop])) {
                <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
            }
        }

        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
    });
};
</code></pre>
<p>By reusing existing operators when you build a new one, you can take advantage of the existing performance or exception handling capabilities implemented in the RxJS libraries.  When writing a custom operator, it is good practice not to leave any disposables unused; otherwise, you may find that resources could actually be leaked and cancellation may not work correctly.</p>
<h2 id="testing-your-new-operator">Testing Your New Operator</h2>
<p>Just because you have implemented a new operator doesn&#39;t mean you are finished.  Now, let&#39;s write a test to verify its behavior from what we learned in the <a href="testing.html">Testing and Debugging</a> topic.  We&#39;ll reuse the <code>collectionAssert.assertEqual</code> from the previous topic so it is not repeated here.</p>
<pre><code class="lang-js"><span class="hljs-keyword">var</span> onNext = Rx.ReactiveTest.onNext,
    onCompleted = Rx.ReactiveTest.onCompleted,
    subscribe = Rx.ReactiveTest.subscribe;

test(<span class="hljs-string">'filterProperties should yield with match'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>

    <span class="hljs-keyword">var</span> scheduler = <span class="hljs-keyword">new</span> Rx.TestScheduler();

    <span class="hljs-keyword">var</span> input = scheduler.createHotObservable(
        onNext(<span class="hljs-number">210</span>, { <span class="hljs-string">'name'</span>: <span class="hljs-string">'curly'</span>, <span class="hljs-string">'age'</span>: <span class="hljs-number">30</span>, <span class="hljs-string">'quotes'</span>: [<span class="hljs-string">'Oh, a wise guy, eh?'</span>, <span class="hljs-string">'Poifect!'</span>] }),
        onNext(<span class="hljs-number">220</span>, { <span class="hljs-string">'name'</span>: <span class="hljs-string">'moe'</span>, <span class="hljs-string">'age'</span>: <span class="hljs-number">40</span>, <span class="hljs-string">'quotes'</span>: [<span class="hljs-string">'Spread out!'</span>, <span class="hljs-string">'You knucklehead!'</span>] }),
        onCompleted(<span class="hljs-number">230</span>)
    );

    <span class="hljs-keyword">var</span> results = scheduler.startWithCreate(
        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
            <span class="hljs-keyword">return</span> input.filterByProperties({ <span class="hljs-string">'age'</span>: <span class="hljs-number">40</span> });
        }
    );

    collectionAssert.assertEqual(results.messages, [
        onNext(<span class="hljs-number">220</span>, { <span class="hljs-string">'name'</span>: <span class="hljs-string">'moe'</span>, <span class="hljs-string">'age'</span>: <span class="hljs-number">40</span>, <span class="hljs-string">'quotes'</span>: [<span class="hljs-string">'Spread out!'</span>, <span class="hljs-string">'You knucklehead!'</span>] }),
        onCompleted(<span class="hljs-number">230</span>)
    ]);

    collectionAssert.assertEqual(input.subscriptions, [
        subscribe(<span class="hljs-number">200</span>, <span class="hljs-number">230</span>)
    ]);
});
</code></pre>
<p>In order for this to be successfully tested, we should check for when there is no data, empty, single matches, multiple matches and so forth.</p>
<h2 id="see-also">See Also</h2>
<p><strong>Resources</strong></p>
<ul>
<li><a href="testing.html">Testing and Debugging</a></li>
</ul>

                    
                    </section>
                
                </div>
            </div>
        </div>

        
        <a href="..\../content/getting_started_with_rxjs/testing_your_rx_application.html" class="navigation navigation-prev "><i class="fa fa-angle-left"></i></a>
        
        
        <a href="..\../content/creating_and_querying_observable_sequences/README.html" class="navigation navigation-next "><i class="fa fa-angle-right"></i></a>
        
    </div>
</div>

        

        <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.1.3/ace.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.1.3/mode-javascript.js"></script>
        <script src="..\..\gitbook/jsrepl/jsrepl.js" id="jsrepl-script"></script>
        <script src="..\..\gitbook/app.js"></script>
        

    
    <script src="..\..\gitbook/plugins/gitbook-plugin-mixpanel/plugin.js"></script>
    

    
    <script src="http://cdn.mathjax.org/mathjax/2.0-latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    

    
    <script src="..\..\gitbook/plugins/gitbook-plugin-mathjax/plugin.js"></script>
    

<script>
require(["gitbook"], function(gitbook) {
    var config = {};
    gitbook.start(config);
});
</script>

    </body>
</html>
